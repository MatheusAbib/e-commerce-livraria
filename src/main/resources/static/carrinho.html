<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seu Carrinho</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/Carrinho.css">

  </head>

<body>
   <header>
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <h1 style="font-size: 1.5rem;">Seu Carrinho</h1>
        <div class="header-actions">
          <a href="principal.html"><i class="bi bi-arrow-left me-1"></i> Voltar à loja</a>
          <div class="notificacao-icon-container">
            <div class="notificacao-icon" id="notificacao-icon">
              <i class="bi bi-bell-fill"></i>
              <span class="notificacao-badge" id="notificacao-badge" style="display: none;">0</span>
            </div>
            <div class="notificacao-dropdown" id="notificacao-dropdown" style="display: none;">
              <div class="notificacao-header">
                <h3>Notificações</h3>
                <button onclick="marcarTodasComoLidas()">Marcar todas como lidas</button>
              </div>
              <div class="notificacao-list" id="notificacao-list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Conteúdo principal -->
  <main class="container my-5">
    <div class="cart-header">
      <h1>Meu Carrinho</h1>
      <p>Revise seus itens antes de finalizar a compra</p>
    </div>
    
    <div class="cart-steps">
      <div class="step completed">
        <div class="step-number">1</div>
        <div class="step-title">Carrinho</div>
      </div>
      <div class="step">
        <div class="step-number">2</div>
        <div class="step-title">Pagamento</div>
      </div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-title">Confirmação</div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-lg-8">
        <!-- Tabela de itens do carrinho -->
        <div class="table-responsive">
          <table class="cart-table" id="cart-items">
            <thead>
              <tr>
                <th>Produto</th>
                <th>Preço</th>
                <th>Quantidade</th>
                <th>Subtotal</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="carrinho-itens" style="display: none;">
              <!-- Itens serão adicionados dinamicamente aqui -->
            </tbody>
          </table>
        </div>

        <!-- Itens expirados -->
        <div class="expired-items-container" id="expired-items-container" style="display: none;">
          <h4>Itens removidos por expiração</h4>
          <button class="carrinho-item-remover" onclick="limparItensExpirados()" title="Limpar todos os itens expirados">
            <i class="bi bi-trash"></i>
          </button>
          <div class="table-responsive">
            <table class="cart-table">
              <thead>
                <tr>
                  <th>Produto</th>
                  <th>Preço</th>
                  <th>Quantidade</th>
                  <th>Motivo</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="expired-items">
                <!-- Itens expirados serão adicionados aqui -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Carrinho vazio -->
        <div class="carrinho-vazio" id="carrinho-vazio">
          <i class="bi bi-cart-x"></i>
          <h3>Seu carrinho está vazio</h3>
          <p>Adicione produtos para continuar com sua compra</p>
          <a href="principal.html" class="btn-voltar">Voltar às Compras</a>
        </div>
        
        <!-- Ações do carrinho -->
        <div class="cart-actions" id="cart-actions" style="display: none;">
          <a href="principal.html" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>Continuar Comprando
          </a>
          <button class="btn btn-outline-danger" onclick="limparCarrinho()">
            <i class="bi bi-trash me-2"></i>Limpar Carrinho
          </button>
        </div>
      </div>
      
      <!-- Resumo do pedido -->
      <div class="col-lg-4">
        <div class="carrinho-total" id="carrinho-total" style="display: none;">
          <h4>Resumo do Pedido</h4>
          
          <div class="summary-row">
            <span>Subtotal</span>
            <span id="subtotal">R$ 0,00</span>
          </div>
          <div class="summary-row">
            <span>Frete</span>
            <span id="frete">R$ 0,00</span>
          </div>
          <div class="summary-row" id="cupom-line" style="display: none;">
            <span>Desconto</span>
            <span class="text-success" id="valor-desconto">-R$ 0,00</span>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <span id="total">R$ 0,00</span>
          </div>
          
          <!-- Seção de Cupons - Modificada para múltiplos cupons -->
          <div class="cupom-container">
            <div class="d-flex gap-2 mb-2">
              <input type="text" id="input-cupom" class="form-control" placeholder="Digite seu cupom">
              <button class="btn-aplicar-cupom" onclick="aplicarCupom()">Aplicar</button>
              </button>
            </div>
            
            <!-- Cupons aplicados -->
            <div id="cupons-aplicados-container">
              <!-- Cupons aplicados serão adicionados aqui dinamicamente -->
            </div>
          </div>

      <!-- Endereço de entrega -->
        <div class="form-group">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <label for="select-endereco">Endereço:</label>
              <button type="button" class="btn-novo-endereco" onclick="abrirModalNovoEndereco()">
                <i class="bi bi-plus-circle"></i> Novo
              </button>
          </div>
          <select id="select-endereco" class="form-control" required>
            <option value="">-- Selecione um endereço --</option>
          </select>
          <div id="detalhes-endereco" class="detalhes-box" style="display:none;"></div>
        </div>



          <!-- Pagamento com cartões -->
          <div class="form-group">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <label>Pagamento:</label>
              <button type="button" class="btn-novo-cartao" onclick="abrirModalNovoCartao()">
                <i class="bi bi-plus-circle"></i> Novo
              </button>
            </div>
            <div id="cartoes-container">
              <!-- Cartões serão adicionados aqui dinamicamente -->
            </div>
                    <button type="button" class="btn-adicionar-cartao mt-2" onclick="adicionarCartao()">
                      <i class="bi bi-plus-circle"></i> Adicionar outro cartão
                    </button>
          </div>

          <!-- Resumo do pagamento -->
          <div id="resumo-pagamento" class="mt-3" style="display: none;">
            <h5>Resumo do Pagamento</h5>
            <div id="resumo-cartoes"></div>
            <div id="resumo-cupons"></div>
            <div class="summary-row total">
              <span>Total a pagar</span>
              <span id="total-pagamento">R$ 0,00</span>
            </div>
          </div>

          <!-- Botão finalizar compra -->
          <button class="btn-finalizar" id="btn-finalizar" onclick="finalizarCompra()">
            <i class="bi bi-credit-card me-2"></i>Finalizar Compra
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Botão restaurar carrinho -->
  <button id="btn-restaurar-carrinho" style="display:none;" onclick="restaurarCarrinhoExpirado()">
    Restaurar pedido anterior
  </button>

  <!-- Notificação de sucesso -->
  <div id="notificacao-sucesso" class="notificacao-sucesso">
    <i class="bi bi-check-circle me-2"></i> Compra realizada com sucesso!
  </div>

  <!-- Temporizador do carrinho -->
  <div id="cart-timer" title="Tempo restante para finalizar a compra">
    <svg class="timer-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2zm1 11h-4v-2h3V7h2v6z"/>
    </svg>
    <div>
      <div class="timer-text" id="timer-display">-</div>
      <div class="timer-label">Tempo para <br>expirar o carrinho</div>
    </div>
  </div>

  <!-- Modal para Mensagens -->
  <div class="modal fade" id="cupomModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cupomModalTitle">Informação do Cupom</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="cupomModalBody">
          <!-- Conteúdo será inserido dinamicamente -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Entendi</button>
        </div>
      </div>
    </div>
  </div>

    <!-- Modal para Novo Endereço -->
<div class="modal fade" id="modalNovoEndereco" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Adicionar Novo Endereço de Entrega</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="form-novo-endereco">
          <!-- Nome do Endereço -->
          <div class="mb-3">
            <label class="form-label">Nome do Endereço (ex: Casa, Trabalho)</label>
            <input type="text" class="form-control" id="novo-endereco-nome" required>
          </div>

          <!-- Linha 1 -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">CEP *</label>
              <input type="text" class="form-control" id="novo-endereco-cep" required maxlength="9">
            </div>
            <div class="col-md-6">
              <label class="form-label">Rua *</label>
              <input type="text" class="form-control" id="novo-endereco-rua" required>
            </div>
          </div>

          <!-- Linha 2 -->
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Número *</label>
              <input type="text" class="form-control" id="novo-endereco-numero" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Complemento</label>
              <input type="text" class="form-control" id="novo-endereco-complemento">
            </div>
            <div class="col-md-4">
              <label class="form-label">Bairro *</label>
              <input type="text" class="form-control" id="novo-endereco-bairro" required>
            </div>
          </div>

          <!-- Linha 3 -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">Cidade *</label>
              <input type="text" class="form-control" id="novo-endereco-cidade" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Estado *</label>
              <select class="form-control" id="novo-endereco-estado" required>
                <option value="">Selecione</option>
                <option value="AC">AC</option>
                <option value="AL">AL</option>
                <option value="AP">AP</option>
                <option value="AM">AM</option>
                <option value="BA">BA</option>
                <option value="CE">CE</option>
                <option value="DF">DF</option>
                <option value="ES">ES</option>
                <option value="GO">GO</option>
                <option value="MA">MA</option>
                <option value="MT">MT</option>
                <option value="MS">MS</option>
                <option value="MG">MG</option>
                <option value="PA">PA</option>
                <option value="PB">PB</option>
                <option value="PR">PR</option>
                <option value="PE">PE</option>
                <option value="PI">PI</option>
                <option value="RJ">RJ</option>
                <option value="RN">RN</option>
                <option value="RS">RS</option>
                <option value="RO">RO</option>
                <option value="RR">RR</option>
                <option value="SC">SC</option>
                <option value="SP">SP</option>
                <option value="SE">SE</option>
                <option value="TO">TO</option>
              </select>
            </div>
          </div>

          <!-- Linha 4 -->
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Tipo de Residência *</label>
              <input type="text" class="form-control" id="novo-endereco-tipo-residencia" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Tipo de Logradouro *</label>
              <input type="text" class="form-control" id="novo-endereco-tipo-logradouro" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Logradouro *</label>
              <input type="text" class="form-control" id="novo-endereco-logradouro" required>
            </div>
          </div>

          <!-- País -->
          <div class="mb-3">
            <label class="form-label">País</label>
            <input type="text" class="form-control" id="novo-endereco-pais" value="Brasil" readonly>
          </div>
        </form>
      </div>
     <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
      <button type="button" class="btn-novo-endereco" onclick="salvarNovoEndereco()">Salvar Endereço</button>
    </div>
    </div>
  </div>
</div>

<!-- Modal de Sucesso -->
<div class="modal fade" id="modalSucessoEndereco" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <div class="modal-sucesso-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
      </div>
      <h3 class="modal-sucesso">Endereço adicionado com sucesso!</h3>
      <button type="button" class="btn btn-primary mt-3" data-bs-dismiss="modal">Fechar</button>
    </div>
  </div>
</div>

<!-- Modal para Novo Cartão -->
<div class="modal fade" id="modalNovoCartao" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Adicionar Novo Cartão</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="form-novo-cartao">
          <!-- Número do Cartão -->
          <div class="mb-3">
            <label class="form-label">Número do Cartão *</label>
            <input type="text" class="form-control" id="novo-cartao-numero" placeholder="0000 0000 0000 0000" required maxlength="19">
          </div>

          <!-- Nome do Titular -->
          <div class="mb-3">
            <label class="form-label">Nome do Titular *</label>
            <input type="text" class="form-control" id="novo-cartao-nome" placeholder="Como está no cartão" required>
          </div>

          <!-- Linha: Bandeira, Validade, CVV -->
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Bandeira *</label>
              <select class="form-control" id="novo-cartao-bandeira" required>
                <option value="">Selecione</option>
                <option value="Visa">Visa</option>
                <option value="Mastercard">Mastercard</option>
                <option value="Elo">Elo</option>
                <option value="American Express">American Express</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Validade *</label>
              <input type="month" class="form-control" id="novo-cartao-validade" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">CVV *</label>
              <input type="text" class="form-control" id="novo-cartao-cvv" placeholder="000" required maxlength="4">
            </div>
          </div>

          <!-- Preferencial -->
          <div class="mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="novo-cartao-preferencial">
              <label class="form-check-label" for="novo-cartao-preferencial">
                Definir como cartão preferencial
              </label>
            </div>
            <small class="text-muted">O cartão preferencial será selecionado por padrão em novas compras</small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn-novo-endereco" onclick="salvarNovoCartao()">Salvar Cartão</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Sucesso Cartão -->
<div class="modal fade" id="modalSucessoCartao" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <div class="modal-sucesso-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
      </div>
      <h3 class="modal-sucesso">Cartão adicionado com sucesso!</h3>
      <button type="button" class="btn btn-primary mt-3" data-bs-dismiss="modal">Fechar</button>
    </div>
  </div>
</div>



  <!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  
<script src="js/carrinho.js"></script>
  
</body>
</html>