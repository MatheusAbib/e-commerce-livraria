<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livraria Online</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/Grafico.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234a6fa5'><path d='M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1zm0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5v11.5z'/></svg>">
</head>
<body>
    <div id="header-container"></div>
<script>
  fetch('header.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('header-container').innerHTML = data;

      setTimeout(() => {
        const clienteLogado = JSON.parse(localStorage.getItem('clienteLogado'));

        if (clienteLogado) {
          const nomeSpan = document.getElementById('nome-cliente');
          if (nomeSpan) nomeSpan.textContent = clienteLogado.nome;

          const linksAdmin = [
            'link-log',
            'link-usuarios',
            'link-historico',
            'link-lucros',
            'link-livros',
            'link-pedidosADMIN'
          ];

          if (clienteLogado.perfil !== 'ADMIN') {
            linksAdmin.forEach(id => {
              const el = document.getElementById(id);
              if (el) el.style.display = 'none';
            });
          } else {
            const statusClienteLink = document.getElementById('link-status-cliente');
            if (statusClienteLink) statusClienteLink.style.display = 'none';
          }

        } else {
          const linksParaOcultar = [
            'link-log',
            'link-usuarios',
            'link-historico',
            'link-lucros',
            'link-livros',
            'link-pedidosADMIN',
            'link-status-cliente'
          ];
          linksParaOcultar.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.style.display = 'none';
          });
        }
      }, 50);
    });
</script>

    <div class="container">
        <h1><i class="fas fa-chart-line"></i> Histórico de Vendas</h1>
        
        <div class="filters">
            <select id="time-period">
                <option value="day">Por Dia</option>
                <option value="week">Por Semana</option>
                <option value="month" selected>Por Mês</option>
                <option value="year">Por Ano</option>
            </select>

            <select id="status-filter">
                <option value="todos" selected>Todos os Status</option>
                <option value="ENTREGUE">Entregue</option>
                <option value="TROCADO">Trocado</option>
                <option value="EM_PROCESSAMENTO">Em Processamento</option>
                <option value="CANCELADO">Cancelado</option>
                <option value="DEVOLUCAO">Devolução</option>
                <option value="DEVOLVIDO">Devolvido</option>
                <option value="EM_TRANSITO">Em Trânsito</option>
            </select>

            <select id="livros-filter" title="Filtrar por livro">
                <option value="" selected>Todos os Livros</option>
                <!-- Opções serão adicionadas dinamicamente -->
            </select>

            <select id="chart-type">
                <option value="line" selected>Gráfico de Linha</option>
                <option value="bar">Gráfico de Barras</option>
            </select>
            
            <input type="date" id="start-date" title="Data inicial">
            <input type="date" id="end-date" title="Data final">

            <button onclick="loadData()" id="refresh-btn">
                <i class="fas fa-check"></i> Aplicar Filtro
            </button>
        </div>
        
        <div class="chart-container">
            <canvas id="salesChart"></canvas>
        </div>
    </div>

    <script src="js/grafico.js"></script>
</body>
</html>
